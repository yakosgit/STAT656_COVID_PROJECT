---
title: 'STAT656_COVID_Project'
output:
  html_document: default
---

# Loading packages and Data
```{r loadingPackages}
packs = c('dplyr','ggplot2', 'caret','corrplot', 'e1071','readr', 'pROC', 'lubridate')
lapply(packs,require,character.only=TRUE)
```

```{r loadingData}
rm(list=ls())# Just to clean up the memory again

# original data from (https://data.cdc.gov/Case-Surveillance/COVID-19-Case-Surveillance-Public-Use-Data-with-Ge/n8mc-b4w4) is ~85+ million rows and ~13GB file size

# filtered data (https://data.cdc.gov/Case-Surveillance/COVID-19-Case-Surveillance-Public-Use-Data-with-Ge/n8mc-b4w4/data) is ~1.4+ million rows and ~200MB file size - removing (missing, NA, unknown) from the following columns:
# death_yn, age_group, hosp_yn,  underlying_conditions_yn, 

# "dataSetPath" is the path to the directory on your PC where you  place the dataset csv file 
#dataSetPath = '/home/yako/Desktop/TAMU_STAT/STAT656_Applied Analytics/STAT656FinalProject/Datasets'
dataSetPathL = '../'
dataSetName = 'COVID-19_Case_Surveillance_Public_Use_Data_with_Geography_Filterd.csv'
dataSet     = read_csv(file.path(dataSetPathL,dataSetName))
```
# Exploratory analysis
items that usually need to be checked:

* data structures
* checking for missing data
* Converting qualitative features to dummy variables
* extreme observations
* skewness/transformations
* correlations

```{r Check data structures}
str(dataSet)
```

```{r Check if any features have NA}
sapply(dataSet, function(x) sum(is.na(x)))

```

```{r Check number of unique values}
rbind(sapply(dataSet,function(x){ length(unique(x))}),
      sapply(dataSet,class))
```

```{r plot feature, fig.align="center", echo = FALSE, fig.width = 12 }
#plot(dataSet$hosp_yn)
#barplot(dataSet$hosp_yn)
require(gridExtra)
theme_update(plot.title = element_text(hjust = 0.5))
#options(repr.plot.width=30, repr.plot.height=30)

colnames = names(dataSet[, sapply(dataSet, class) %in% c('character', 'factor')])[-c(1,2,3,4,5,16)]
for (colname in colnames) {
  
  plot1 = ggplot(filter(dataSet,death_yn == "No" ), aes(x=reorder(.data[[colname]], .data[[colname]], function(x)-length(x)))) +
    geom_bar() +  labs(x=colname) + labs(title = paste("Counts of", colname, "when:", "\n", "death_yn" , "=", "No" ))
  
  plot2 = ggplot(filter(dataSet,death_yn == "Yes" ), aes(x=reorder(.data[[colname]], .data[[colname]], function(x)-length(x)))) +
    geom_bar() +  labs(x=colname) + labs(title = paste("Counts of", colname, "when:", "\n", "death_yn" , "=", "Yes" ))
  
  grid.arrange(plot1, plot2, ncol=2)
  
}



```

Note from Laura: This underlying_conditions_yn column might be problematic

```{r Data structure and spliting}
Y       = select(dataSet,death_yn) %>% unlist()
X       = select(dataSet,-death_yn)
```

# Loading in Vaccination Data as a potential predictor

```{r load in the vaccination data}
vaxSetPathL = '../'
vaxSetName = 'COVID-19_Vaccinations_in_the_United_States_County.csv'
vaxSet     = read_csv(file.path(vaxSetPathL,vaxSetName))
```

```{r filtering columns}
#filtering out most of the columns and just keeping what we need
vaxSet = vaxSet %>% select(c(Date, FIPS, Series_Complete_Pop_Pct, Census2019, Census2019_65PlusPop))

```


```{r formatting date to fit our COVID case dataset}
vaxSet$Day = as.numeric(format(as.Date(vaxSet$Date,format="%m/%d/%Y"), format = "%d"))
vaxSet$Date = format(as.Date(vaxSet$Date,format="%m/%d/%Y"), format = "%Y-%m")
```

I'm going to take the number from the end of the month in order to get it to work with our data

```{r group by for each month}
vaxSet = vaxSet %>% group_by(Date, FIPS) %>% summarize(Series_Complete_Pop_Pct = max(Series_Complete_Pop_Pct),
                                                       Census2019 = max(Census2019),
                                                       Census2019_65PlusPop = max(Census2019_65PlusPop))
```

```{r adjust date from original dataset}
#adding the first to these dates so that we can use this as a date
dataSet$case_month = as.Date(paste(dataSet$case_month,"-01",sep=""))
```

```{r adjust date from vax dataset}
#this gives you the date where the vax data is considered to be valid 
vaxSet$Date = as.Date(paste(vaxSet$Date,"-01",sep="")) %m+% months(1)
```


This is as far as I got. I have to figure out how to join this in 
```{r}

```



# Building Models:

```{r}
#testing
```

```{r}

```

```{r}

```

```{r}

```


